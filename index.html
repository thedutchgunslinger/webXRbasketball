<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://aframe.io/releases/1.0.4/aframe.min.js"></script>
    <!-- <script src="https://unpkg.com/aframe-animation-component@3.2.1/dist/aframe-animation-component.min.js"></script> -->
    <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.min.js"></script>
    <!--     <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-extras@v6.1.1/dist/aframe-extras.controls.min.js"></script> -->
    <script src="https://unpkg.com/super-hands@^3.0.3/dist/super-hands.min.js"></script>
    <script src="//cdn.rawgit.com/donmccurdy/aframe-physics-system/v4.0.1/dist/aframe-physics-system.min.js"></script>
    <script src="https://unpkg.com/aframe-physics-extras@0.1.2/dist/aframe-physics-extras.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/a-super-sky@1.1.0/super-sky.js"></script>
    <script src="controls.js"></script>
<!--     <script src="https://recast-api.donmccurdy.com/aframe-inspector-plugin-recast.js"></script> -->

    <title>webvr</title>
  </head>
  <body>
    <a-scene
      id="scene"
      physics="debug:true; restitution: 0.9; "

      
    >
    <a-assets>
        <a-asset-item id="city" src="assets/models/city.glb"></a-asset-item>
        <a-asset-item id="nav" src="assets/models/nav.glb"></a-asset-item>
        <img id="skymap" src="assets/textures/clear-sunny-sky.jpg">
        <img id="balltexture" src="assets/textures/balldimpled.png">
        <img id="grasstexture" src="assets/textures/istockphoto-865924416-612x612.png">
    </a-assets>
      <!-- <a-sky
        src="#skymap"
      ></a-sky> -->
      <a-super-sky cycleduration="1" groundcolor="#7BC8A4" ></a-super-sky>
      <a-entity gltf-model="#city" scale="3 3 3"></a-entity>
      <a-entity  gltf-model="#nav" position="4.8 0.15 3.7" rotation="0 0 0" nav-mesh visible="false"></a-entity>
      <a-entity id="rig" movement-controls="constrainToNavMesh: true" position="0.5 0 0">
        <a-camera id="camera" position="0 1.6 0" look-controls></a-camera>
        <a-entity
          physics-collider
          static-body="shape: sphere; sphereRadius: 0.05;"
          sphere-collider="objects: a-box"
          super-hands="colliderEvent: collisions;
                            colliderEventProperty: els;
                            colliderEndEvent: collisions;
                            colliderEndEventProperty: clearedEls"
          collision-filter="group: hands;
                                   collidesWith: ball, basket;
                                   collisionForces: false"
          hand-controls="hand: left"
   
        >
        </a-entity>
        <a-entity
          physics-collider
          static-body="shape: sphere; sphereRadius: 0.05;"
          sphere-collider="objects: a-box"
          super-hands="colliderEvent: collisions;
                            colliderEventProperty: els;
                            colliderEndEvent: collisions;
                            colliderEndEventProperty: clearedEls"
          collision-filter="group: hands;
                                   collidesWith: ball, basket;
                                   collisionForces: false"
          hand-controls="hand: right"
          snap-turn="target: #rig; reference: #camera; angle: 45"
        ></a-entity>
      </a-entity>
      <!-- <a-light  type="point" color="red" ></a-light> -->
      <a-entity static-body="shape: sphere; sphereRadius: 0.1;" light="type: spot; angle: 30; color: #fff5b6; intensity: 1"  position="-7.6 4 -5" rotation="-45 225 0"></a-entity>
      <a-entity static-body="shape: sphere; sphereRadius: 0.1;" light="type: spot; angle: 30; color: #fff5b6; intensity: 1"  position="-7.6 4 7.8" rotation="-45 -45 0"></a-entity>

      <a-entity static-body="shape: sphere; sphereRadius: 0.1;" light="type: spot; angle: 30; color: #fff5b6; intensity: 1"  position="8.6 4 -5" rotation="-45 135 0"></a-entity>
      <a-entity static-body="shape: sphere; sphereRadius: 0.1;" light="type: spot; angle: 30; color: #fff5b6; intensity: 1"  position="8.6 4 7.8" rotation="-45 -315 0"></a-entity>
      <!--   FLOOR     -->
      <a-plane
      id="ground"
        static-body
        color="ffffff"
        rotation="-90 0 0"
        scale="20 20 20"
        collision-filter="collidesWith: ball, basket"
        visible="false"
      ></a-plane>
      <!-- <a-ocean
        color="#92E2E2"
        width="100"
        depth="100"
        position="0 -0.5 0"
        density="15"
        speed="1"
      ></a-ocean> -->
      <!--       WALLS -->
      <a-plane
        static-body
        visible="false"
        color="forestgreen"
        rotation="0 0 0"
        position="0.5 7.5 -6.6"
        scale="15 15 15"
        collision-filter="collidesWith: ball, basket"
      ></a-plane>
      <a-plane
        static-body
        visible="false"
        color="forestgreen"
        rotation="0 180 0"
        position="0.5 7.5 9.4"
        scale="15 15 15"
        collision-filter="collidesWith: ball, basket"
      ></a-plane>
      <a-plane
        static-body
        visible="false"
        color="forestgreen"
        rotation="0 90 0"
        position="-6.8 7.5 1.3"
        scale="16 15 15"
        collision-filter="collidesWith: ball, basket"
      ></a-plane>
      <a-plane
        static-body
        visible="false"
        color="forestgreen"
        rotation="0 270 0"
        position="8.1 7.5 1.3"
        scale="16 15 15"
        collision-filter="collidesWith: ball, basket"
      ></a-plane>
      <a-entity
        text="value: Welkom bij basketball webXr!; width: 6;color: red;"
        position="0 5 -7.4.95"
      ></a-entity>
      <a-entity
        id="scoreText"
        text="value: Score: 0; width: 6;color: red;"
        position="0 4.7 -7.4.95"
      ></a-entity>
      <a-sphere
        id="ball"
        grabbable
        dynamic-body="shape:sphere;mass: 1"
        color="orange"
        radius="0.2"
        position="0.5 1 -3"
        collision-filter="group: ball; collidesWith: default, hands, basket, baskettrigger"
        material="src: #balltexture;"
      ></a-sphere>
      <a-entity position="0.5 -0.8 -5">
        <a-cylinder
          static-body
          collision-filter="group: basket; collidesWith: ball"
          color="firebrick"
          height="3"
          radius="0.03"
          position="0 1.5 0"
        ></a-cylinder>
        <a-cylinder
          static-body
          collision-filter="group: basket; collidesWith: ball"
          color="firebrick"
          height="0.2"
          radius="0.03"
          position="0 3 0.1"
          rotation="90 0 0"
        ></a-cylinder>
        <a-box
          static-body
          collision-filter="group: basket; collidesWith: ball"
          color="ghostwhite"
          width="1"
          height="0.6"
          depth="0.07"
          position="0 3 0.2"
          ><a-entity
            id="scoreTextBasket"
            text="value: 0; width: 6;color: red;"
            position="2.9 0.1 0.04"
          ></a-entity
        ></a-box>

        <a-torus
          static-body="shape: mesh; collisionForces: true"
          collision-filter="group: basket; collidesWith: ball"
          color="firebrick"
          radius="0.4"
          radius-tubular="0.01"
          rotation="90 0 0"
          position="0 2.8 0.61"
        ></a-torus>
        <a-cylinder
          id="score"
          visible="false"
          radius="0.3.5"
          height="0.001"
          static-body="shape: cylinder;"
          collision-filter="group: baskettrigger; collidesWith: ball; collisionForces: false"
          rotation="0 0 0"
          position="0 2.8 0.61"
          ignoresleep="true"
        ></a-cylinder>
      </a-entity>
      <script>
        let score = 0;

         var audioCity = new Audio('assets/sounds/citySounds.mp3');
             audioCity.play();
             audioCity.loop = true;
             audioCity.volume = 0.1;

        var playerEl = document.querySelector("#score");
        var canListen = true; // a variable to store the state of the event listener
        playerEl.addEventListener("collide", function (e) {
          if (canListen) {
            console.log(e.detail.body.id)
            // check if the event listener can listen
            if (e.detail.body.id == 11) {
              score++;
              document
                .querySelector("#scoreText")
                .setAttribute(
                  "text",
                  "width: 6; color: red; value: Score: " + score
                );
              document
                .querySelector("#scoreTextBasket")
                .setAttribute("text", "width: 6; color: red; value: " + score);
              console.log(score);
            }
            canListen = false; // set the state to false
            setTimeout(function () {
              // use a setTimeout function to reset the state after one second
              canListen = true;
            }, 1000);
          }
        });
        var ground = document.querySelector("#ground");
var lastCollisionTime = 0;
var collisionCount = 0;
var resetTimeout;
ground.addEventListener("collide", function (e) {
  var now = Date.now();
  if (e.detail.body.id == 11 && now - lastCollisionTime > 200) {
    // console.log("hit the ground");
    lastCollisionTime = now;
    collisionCount = 0;
    clearTimeout(resetTimeout);
    resetTimeout = setTimeout(function() {
      collisionCount = 0;
    }, 1000); // Reset after 1 second
  }
  if (collisionCount < 1) {
    var audio = new Audio('assets/sounds/mixkit-ball-bouncing-in-the-ground-2077.wav');
    audio.play();
    collisionCount++;
  }else{
    
  }
});
var ball = document.querySelector("#ball")

ball.addEventListener("collide", function (e) {
          if (canListen) {
            console.log(e.detail.body.id)
            // check if the event listener can listen
           if (e.detail.body.id == 12 || e.detail.body.id == 13 || e.detail.body.id == 14 || e.detail.body.id == 15 || e.detail.body.id == 16) {
      var audio = new Audio('assets/sounds/mixkit-basketball-ball-hitting-the-net-2084.wav');
    audio.play();
      // Do something when the ball hits the basket, e.g. increase score
    }
            canListen = false; // set the state to false
            setTimeout(function () {
              // use a setTimeout function to reset the state after one second
              canListen = true;
            }, 1000);
          }
        });



      </script>
    </a-scene>
  </body>
</html>
